melt(.)
diff_se_melt
head(diff_se_melt)
ggplot(diff_elpd_melt, aes(x=variable, y=value, fill=value)) +
geom_violin()
ggplot(diff_elpd_melt, aes(x=variable, y=value, fill=value)) +
geom_violin() + labs(title="Pairwise elpd_diff")  +
scale_fill_brewer(palette = "RdYlGn")
ggplot(diff_elpd_melt, aes(x=variable, y=value, fill=value)) +
geom_violin() + labs(title="Pairwise elpd_diff")  +
scale_fill_manual(palette = "RdYlGn")
ggplot(diff_elpd_melt, aes(x=variable, y=value, fill=value)) +
geom_violin() + labs(title="Pairwise elpd_diff")
ggplot(diff_se_melt, aes(x=variable, y=value, fill=value)) +
geom_violin() + labs(title="Pairwise se_diff")  +
scale_fill_brewer(palette = "RdYlGn")
ggplot(diff_elpd_melt, aes(x=variable, y=value, fill=variable)) +
geom_violin() + labs(title="Pairwise elpd_diff")  +
scale_fill_manual(palette = "RdYlGn")
ggplot(diff_elpd_melt, aes(x=variable, y=value, fill=variable)) +
geom_violin() + labs(title="Pairwise elpd_diff")
ggplot(diff_se_melt, aes(x=variable, y=value, fill=variable)) +
geom_violin() + labs(title="Pairwise se_diff")
ggplot(diff_se_melt, aes(x=variable, y=value, fill=variable)) +
geom_violin() + labs(title="Pairwise se_diff")  +
scale_fill_brewer(palette = "RdYlGn")
ggplot(diff_se_melt, aes(x=variable, y=value, fill=variable)) +
geom_violin() + labs(title="Pairwise se_diff")  +
scale_fill_brewer(palette = "RdYlGn") + theme(legend. position = "none")
ggplot(diff_se_melt, aes(x=variable, y=value, fill=variable)) +
geom_violin() + labs(title="Pairwise se_diff")  +
scale_fill_brewer(palette = "RdYlGn") + theme(legend.position = "none")
ggplot(diff_elpd_melt, aes(x=variable, y=value, fill=variable)) +
geom_violin() + labs(title="Pairwise elpd_diff") + theme(legend. position = "none")
ggplot(diff_elpd_melt, aes(x=variable, y=value, fill=variable)) +
geom_violin() + labs(title="Pairwise elpd_diff") + theme(legend.position = "none")
ggplot(diff_se_melt, aes(x=variable, y=value, fill=variable)) +
geom_violin() + labs(title="Pairwise se_diff")  + theme(legend.position = "none")
head(samp_data_list[1])
colnames(samp_data_list[1])
names(samp_data_list[1])
ggplot(diff_se_melt, aes(x=variable, y=value, fill=variable)) +
geom_violin() + labs(title="Pairwise se_diff") +
theme(legend.position = "none") +
scale_fill_brewer(palette = "Dark2")
gg1 = ggplot(diff_elpd_melt, aes(x=variable, y=value, fill=variable)) +
geom_violin() + labs(title="Pairwise elpd_diff") +
theme(legend.position = "none") +
scale_fill_brewer(palette = "Dark2")
gg2 = ggplot(diff_se_melt, aes(x=variable, y=value, fill=variable)) +
geom_violin() + labs(title="Pairwise se_diff") +
theme(legend.position = "none") +
scale_fill_brewer(palette = "Dark2")
gridExtra::grid.arrange(gg1,gg2)
gg2 = ggplot(diff_se_melt, aes(x=variable, y=value, fill=variable)) +
geom_violin() + labs(title="Pairwise se_diff") +
theme(legend.position = "none") +
scale_fill_brewer(palette = "Dark2") |
labs(x="", y="std. error diff")
ggplot(diff_se_melt, aes(x=variable, y=value, fill=variable)) +
geom_violin() + labs(title="Pairwise se_diff") +
theme(legend.position = "none") +
scale_fill_brewer(palette = "Dark2") +
labs(x="", y="std. error diff")
gg1 = ggplot(diff_elpd_melt, aes(x=variable, y=value, fill=variable)) +
geom_violin() + labs(title="Pairwise elpd_diff") +
theme(legend.position = "none") +
scale_fill_brewer(palette = "Dark2") +
labs(x="", y="elpd diff")
gg2 = ggplot(diff_se_melt, aes(x=variable, y=value, fill=variable)) +
geom_violin() + labs(title="Pairwise se_diff") +
theme(legend.position = "none") +
scale_fill_brewer(palette = "Dark2") +
labs(x="", y="std. error diff")
gridExtra::grid.arrange(gg1,gg2)
sim_list[[1]]
-346+318
-318+346
g
g
gg1 = ggplot(diff_elpd_melt, aes(x=variable, y=value, fill=variable)) +
geom_violin() + labs(title="Pairwise elpd_diff") +
theme(legend.position = "none") +
scale_fill_brewer(palette = "Dark2") +
labs(x="", y="elpd diff")
gg2 = ggplot(diff_se_melt, aes(x=variable, y=value, fill=variable)) +
geom_violin() + labs(title="Pairwise se_diff") +
theme(legend.position = "none") +
scale_fill_brewer(palette = "Dark2") +
labs(x="", y="std. error diff")
png(file="loo_elpd_se_diff.png", width=750, height=790)
gridExtra::grid.arrange(gg1,gg2)
dev.off()
png(file="loo_elpd_se_diff.png", width=70, height=790)
gridExtra::grid.arrange(gg1,gg2)
dev.off()
png(file="loo_elpd_se_diff.png", width=700, height=790)
gridExtra::grid.arrange(gg1,gg2)
dev.off()
sim_list[[1]]
pairdiff(samp_data_list[[1]]$elpd_1, samp_data_list[[1]]$elpd_2)
pairdiff(samp_data_list[[1]]$elpd_1, samp_data_list[[1]]$elpd_2, 'elpd_diff_12', 'se_diff_12')
sqrt(N)*sd(-346.9239+318.6182)
loo_wtd
head(samp_data_list[[1]])
svy_rake
svy_rake = svydesign(ids=~1, # cluster id, ~1 for no clusters
weights=~wts, # including raked weights in the survey design
data=samp_data_list[[1]])
librayr(survey)
library(survey)
svy_rake = svydesign(ids=~1, # cluster id, ~1 for no clusters
weights=~wts, # including raked weights in the survey design
data=samp_data_list[[1]])
svy_rake
dat = samp_data_list[[1]]
svytotal(dat$elpd_1 - dat1$elpd2, svy_rake)
svytotal(dat$elpd_1 - dat$elpd2, svy_rake)
svytotal(dat$elpd_2 - dat$elpd1, svy_rake)
svytotal(dat$elpd_2 - dat$elpd_1, svy_rake)
svytotal(dat$elpd_1 - dat$elpd_2, svy_rake)
test = samp_data_list[1:5]
lapply(test, function(x)svydesign(ids=)~1,weights=~wts,data=x)
lapply(test, function(x){svydesign(ids=)~1,weights=~wts,data=x})
lapply(test, function(x){svydesign(ids=~1,weights=~wts,data=x})
lapply(test, function(x)svydesign(ids=~1,weights=~wts,data=x)
)
lapply(test, function(x)svydesign(ids=~1,weights=~wts,data=x))
diff14
svytotal(diff12[,1])
svytotal(diff12[,1], svy_rake)
svy_rake
svytotal(diff12[,1], svy_rake)
diff12[,1]
# weighted elpd and se diff -----------------------------------------------
svy_rake = svydesign(ids=~1, # cluster id, ~1 for no clusters
weights=~wts, # including raked weights in the survey design
data=samp_data_list[[1]])
svytotal(diff12[,1], svy_rake)
diff12
svytotal(test$elpd_1 - test$elpd_2, svy_rake)
head(test)
svytotal(test[[1]]$elpd_1 - test[[1]]$elpd_2, svy_rake)
lapply(test, function(x)svytotal(x$elpd_1 - x$elpd_2, svy_rake)
)
rake = lapply(test, function(x)svydesign(ids=~1,weights=~wts,data=x))
i
i=1
svytotal(test[[i]]$elpd_1 - test[[i]]$elpd_2, rake[[i]])
i=2
svytotal(test[[i]]$elpd_1 - test[[i]]$elpd_2, rake[[i]])
i=3
svytotal(test[[i]]$elpd_1 - test[[i]]$elpd_2, rake[[i]])
elpd_wtd_diff = matrix(NA, nrow=length(test))
elpd_wtd_diff[i,] = svytotal(test[[i]]$elpd_1 - test[[i]]$elpd_2, rake[[i]])
test = samp_data_list[1:5]
rake = lapply(test, function(x)svydesign(ids=~1,weights=~wts,data=x))
elpd_wtd_diff = matrix(NA, nrow=length(test))
for(i in 1:length(test)){
elpd_wtd_diff[i,] = svytotal(test[[i]]$elpd_1 - test[[i]]$elpd_2, rake[[i]])
}
elpd_wtd_diff
svytotal(test[[i]]$elpd_1 - test[[i]]$elpd_2, rake[[i]])
elpd_wtd_diff = matrix(NA, nrow=length(test), ncol=2)
for(i in 1:length(test)){
elpd_wtd_diff[i,] = svytotal(test[[i]]$elpd_1 - test[[i]]$elpd_2, rake[[i]])
}
elpd_wtd_diff
svytotal(test[[i]]$elpd_1 - test[[i]]$elpd_2, rake[[i]])
elpd_wtd_diff = vector(NA, length=length(test))
for(i in 1:length(test)){
elpd_wtd_diff[i,] = svytotal(test[[i]]$elpd_1 - test[[i]]$elpd_2, rake[[i]])
}
elpd_wtd_diff
elpd_wtd_diff = vector(NA, length=length(test))
for(i in 1:length(test)){
elpd_wtd_diff[i] = svytotal(test[[i]]$elpd_1 - test[[i]]$elpd_2, rake[[i]])
}
elpd_wtd_diff
elpd_wtd_diff = lapply(1:length=length(test))
elpd_wtd_diff = lapply(1:length(test))
elpd_wtd_diff = lapply(1:length(test), vector(NA))
elpd_wtd_diff = lapply(1:length(test), vector())
elpd_wtd_diff = lapply(1:length(test), vector(mode="logical"))
elpd_wtd_diff = lapply(1:length(test), vector(length = 2))
elpd_wtd_diff = lapply(1:length(test), function(x)vector(length = 2))
elpd_wtd_diff
elpd_wtd_diff = lapply(1:length(test), function(x)vector(length = 2))
for(i in 1:
for(i in 1:length(test)){
elpd_wtd_diff[i] = svytotal(test[[i]]$elpd_1 - test[[i]]$elpd_2, rake[[i]])
}
elpd_wtd_diff
elpd_wtd_diff[[i]] = svytotal(test[[i]]$elpd_1 - test[[i]]$elpd_2, rake[[i]])
elpd_wtd_diff[[i]]
elpd_wtd_diff = lapply(1:length(test), function(x)vector(length = 2))
for(i in 1:length(test)){
elpd_wtd_diff[[i]] = svytotal(test[[i]]$elpd_1 - test[[i]]$elpd_2, rake[[i]])
}
elpd_wtd_diff
dat = samp_data_list[1:5]
rake = lapply(dat, function(x)svydesign(ids=~1,weights=~wts,data=x))
wtd_diff12 = lapply(1:length(dat), function(x)vector(length = 2))
for(i in 1:length(dat)){
wtd_diff12[[i]] = svytotal(dat[[i]]$elpd_1 - dat[[i]]$elpd_2, rake[[i]])
}
wtd_diff12
for(i in 1:length(dat)){
wtd_diff12[[i]] = svytotal(dat[[i]]$elpd_1 - dat[[i]]$elpd_2, rake[[i]])
}
wtd_diff13 = lapply(1:length(dat), function(x)vector(length = 2))
for(i in 1:length(dat)){
wtd_diff13[[i]] = svytotal(dat[[i]]$elpd_1 - dat[[i]]$elpd_2, rake[[i]])
}
wtd_diff13
wtd_diff14 = lapply(1:length(dat), function(x)vector(length = 2))
for(i in 1:length(dat)){
wtd_diff14[[i]] = svytotal(dat[[i]]$elpd_1 - dat[[i]]$elpd_2, rake[[i]])
}
wtd_diff14
wtd_diff12 = lapply(1:length(dat), function(x)vector(length = 2))
for(i in 1:length(dat)){
wtd_diff12[[i]] = svytotal(dat[[i]]$elpd_1 - dat[[i]]$elpd_2, rake[[i]])
}
wtd_diff13 = lapply(1:length(dat), function(x)vector(length = 2))
for(i in 1:length(dat)){
wtd_diff13[[i]] = svytotal(dat[[i]]$elpd_1 - dat[[i]]$elpd_3, rake[[i]])
}
wtd_diff14 = lapply(1:length(dat), function(x)vector(length = 2))
for(i in 1:length(dat)){
wtd_diff14[[i]] = svytotal(dat[[i]]$elpd_1 - dat[[i]]$elpd_4, rake[[i]])
}
wtd_diff23 = lapply(1:length(dat), function(x)vector(length = 2))
for(i in 1:length(dat)){
wtd_diff23[[i]] = svytotal(dat[[i]]$elpd_2 - dat[[i]]$elpd_3, rake[[i]])
}
wtd_diff24 = lapply(1:length(dat), function(x)vector(length = 2))
for(i in 1:length(dat)){
wtd_diff24[[i]] = svytotal(dat[[i]]$elpd_2 - dat[[i]]$elpd_4, rake[[i]])
}
wtd_diff34 = lapply(1:length(dat), function(x)vector(length = 2))
for(i in 1:length(dat)){
wtd_diff34[[i]] = svytotal(dat[[i]]$elpd_3 - dat[[i]]$elpd_4, rake[[i]])
}
wtd_diff12
wtd_diff13
wtd_diff14
wtd_diff23
wtd_diff24
wtd_diff34
dat = samp_data_list[1:60]
rake = lapply(dat, function(x)svydesign(ids=~1,weights=~wts,data=x))
wtd_diff12 = lapply(1:length(dat), function(x)vector(length = 2))
for(i in 1:length(dat)){
wtd_diff12[[i]] = svytotal(dat[[i]]$elpd_1 - dat[[i]]$elpd_2, rake[[i]])
}
wtd_diff13 = lapply(1:length(dat), function(x)vector(length = 2))
for(i in 1:length(dat)){
wtd_diff13[[i]] = svytotal(dat[[i]]$elpd_1 - dat[[i]]$elpd_3, rake[[i]])
}
wtd_diff14 = lapply(1:length(dat), function(x)vector(length = 2))
for(i in 1:length(dat)){
wtd_diff14[[i]] = svytotal(dat[[i]]$elpd_1 - dat[[i]]$elpd_4, rake[[i]])
}
wtd_diff23 = lapply(1:length(dat), function(x)vector(length = 2))
for(i in 1:length(dat)){
wtd_diff23[[i]] = svytotal(dat[[i]]$elpd_2 - dat[[i]]$elpd_3, rake[[i]])
}
wtd_diff24 = lapply(1:length(dat), function(x)vector(length = 2))
for(i in 1:length(dat)){
wtd_diff24[[i]] = svytotal(dat[[i]]$elpd_2 - dat[[i]]$elpd_4, rake[[i]])
}
wtd_diff34 = lapply(1:length(dat), function(x)vector(length = 2))
for(i in 1:length(dat)){
wtd_diff34[[i]] = svytotal(dat[[i]]$elpd_3 - dat[[i]]$elpd_4, rake[[i]])
}
wtd_diff34
dat = samp_data_list[1:5]
rake = lapply(dat, function(x)svydesign(ids=~1,weights=~wts,data=x))
wtd_diff12 = lapply(1:length(dat), function(x)vector(length = 2))
for(i in 1:length(dat)){
wtd_diff12[[i]] = svytotal(dat[[i]]$elpd_1 - dat[[i]]$elpd_2, rake[[i]])
}
wtd_diff13 = lapply(1:length(dat), function(x)vector(length = 2))
for(i in 1:length(dat)){
wtd_diff13[[i]] = svytotal(dat[[i]]$elpd_1 - dat[[i]]$elpd_3, rake[[i]])
}
wtd_diff14 = lapply(1:length(dat), function(x)vector(length = 2))
for(i in 1:length(dat)){
wtd_diff14[[i]] = svytotal(dat[[i]]$elpd_1 - dat[[i]]$elpd_4, rake[[i]])
}
wtd_diff23 = lapply(1:length(dat), function(x)vector(length = 2))
for(i in 1:length(dat)){
wtd_diff23[[i]] = svytotal(dat[[i]]$elpd_2 - dat[[i]]$elpd_3, rake[[i]])
}
wtd_diff24 = lapply(1:length(dat), function(x)vector(length = 2))
for(i in 1:length(dat)){
wtd_diff24[[i]] = svytotal(dat[[i]]$elpd_2 - dat[[i]]$elpd_4, rake[[i]])
}
wtd_diff34 = lapply(1:length(dat), function(x)vector(length = 2))
for(i in 1:length(dat)){
wtd_diff34[[i]] = svytotal(dat[[i]]$elpd_3 - dat[[i]]$elpd_4, rake[[i]])
}
wtd_diff34
do.call(rbind,wtd_diff34)
do.call(cbind,wtd_diff34)
wtd_diff12[[1]]
wtd_diff12[[1]][2]
wtd_diff12[[1]][1,2]
wtd_diff12[[1]][1]
wtd_diff12[[1]][1,]
wtd_diff12[[i]] = data.frame(svytotal(dat[[i]]$elpd_1 - dat[[i]]$elpd_2, rake[[i]]))
wtd_diff12[[i]]
wtd_diff12 = lapply(1:length(dat), function(x)vector(length = 2))
for(i in 1:length(dat)){
wtd_diff12[[i]] = data.frame(svytotal(dat[[i]]$elpd_1 - dat[[i]]$elpd_2, rake[[i]]))
}
wtd_diff12
do.call(cbind,wtd_diff12)
do.call(rbind,wtd_diff12)
wtd_diff12[[i]] <- (svytotal(dat[[i]]$elpd_1 - dat[[i]]$elpd_2, rake[[i]])) %>%
data.frame()
wtd_diff12[[i]]
wtd_diff12[[i]] <- (svytotal(dat[[i]]$elpd_1 - dat[[i]]$elpd_2, rake[[i]])) %>%
data.frame() %>%
colnames('elpd_diff_wtd', 'se_diff_wtd')
wtd_diff12[[i]] <- (svytotal(dat[[i]]$elpd_1 - dat[[i]]$elpd_2, rake[[i]])) %>%
data.frame() %>%
rename(total='elpd_diff_wtd',SE='se_diff_wtd')
(svytotal(dat[[i]]$elpd_1 - dat[[i]]$elpd_2, rake[[i]])) %>%
data.frame() %>%
rename(total=elpd_diff_wtd
)
temp = data.frame(svytotal(dat[[i]]$elpd_1 - dat[[i]]$elpd_2, rake[[i]]))
colnames(temp) = c('elpd_diff_wtd', 'se_diff_wtd'))
colnames(temp) = c('elpd_diff_wtd', 'se_diff_wtd')
temp
for(i in 1:length(dat)){
temp = data.frame(svytotal(dat[[i]]$elpd_1 - dat[[i]]$elpd_2, rake[[i]]))
colnames(temp) = c('elpd_diff_wtd', 'se_diff_wtd')
wtd_diff12[[i]] = temp
}
wtd_diff12
do.call(rbind,wtd_diff12)
wtd_diff12 = lapply(1:length(dat), function(x)vector(length = 2))
for(i in 1:length(dat)){
temp = data.frame(svytotal(dat[[i]]$elpd_1 - dat[[i]]$elpd_2, rake[[i]]))
colnames(temp) = c('elpd_diff_wtd_12', 'se_diff_wtd_12')
wtd_diff12[[i]] = temp
}
do.call(rbind,wtd_diff12)
do.call(rbind,wtd_diff34)
wtd_diff12 = lapply(1:length(dat), function(x)vector(length = 2))
for(i in 1:length(dat)){
temp = data.frame(svytotal(dat[[i]]$elpd_1 - dat[[i]]$elpd_2, rake[[i]]))
colnames(temp) = c('elpd_diff_wtd_12', 'se_diff_wtd_12')
wtd_diff12[[i]] = temp
}
do.call(rbind,wtd_diff12)
wtd_diff13 = lapply(1:length(dat), function(x)vector(length = 2))
for(i in 1:length(dat)){
temp = data.frame(svytotal(dat[[i]]$elpd_1 - dat[[i]]$elpd_3, rake[[i]]))
colnames(temp) = c('elpd_diff_wtd_13', 'se_diff_wtd_13')
wtd_diff13[[i]] = temp
}
do.call(rbind,wtd_diff13)
wtd_diff14 = lapply(1:length(dat), function(x)vector(length = 2))
for(i in 1:length(dat)){
temp = data.frame(svytotal(dat[[i]]$elpd_1 - dat[[i]]$elpd_4, rake[[i]]))
colnames(temp) = c('elpd_diff_wtd_14', 'se_diff_wtd_14')
wtd_diff14[[i]] = temp
}
do.call(rbind,wtd_diff14)
wtd_diff23 = lapply(1:length(dat), function(x)vector(length = 2))
for(i in 1:length(dat)){
temp = data.frame(svytotal(dat[[i]]$elpd_2 - dat[[i]]$elpd_3, rake[[i]]))
colnames(temp) = c('elpd_diff_wtd_23', 'se_diff_wtd_23')
wtd_diff23[[i]] = temp
}
do.call(rbind,wtd_diff23)
wtd_diff24 = lapply(1:length(dat), function(x)vector(length = 2))
for(i in 1:length(dat)){
temp = data.frame(svytotal(dat[[i]]$elpd_2 - dat[[i]]$elpd_4, rake[[i]]))
colnames(temp) = c('elpd_diff_wtd_24', 'se_diff_wtd_24')
wtd_diff24[[i]] = temp
}
do.call(rbind,wtd_diff24)
wtd_diff34 = lapply(1:length(dat), function(x)vector(length = 2))
for(i in 1:length(dat)){
temp = data.frame(svytotal(dat[[i]]$elpd_3 - dat[[i]]$elpd_4, rake[[i]]))
colnames(temp) = c('elpd_diff_wtd_34', 'se_diff_wtd_34')
wtd_diff34[[i]] = temp
}
do.call(rbind,wtd_diff34)
dat = samp_data_list[1:5]
rake = lapply(dat, function(x)svydesign(ids=~1,weights=~wts,data=x))
diff12 = lapply(1:length(dat), function(x)vector(length = 2))
for(i in 1:length(dat)){
temp = data.frame(svytotal(dat[[i]]$elpd_1 - dat[[i]]$elpd_2, rake[[i]]))
colnames(temp) = c('elpd_diff_wtd_12', 'se_diff_wtd_12')
diff12[[i]] = temp
}
wtd_diff12 = do.call(rbind,diff12)
diff13 = lapply(1:length(dat), function(x)vector(length = 2))
for(i in 1:length(dat)){
temp = data.frame(svytotal(dat[[i]]$elpd_1 - dat[[i]]$elpd_3, rake[[i]]))
colnames(temp) = c('elpd_diff_wtd_13', 'se_diff_wtd_13')
diff13[[i]] = temp
}
wtd_diff13 = do.call(rbind,diff13)
diff14 = lapply(1:length(dat), function(x)vector(length = 2))
for(i in 1:length(dat)){
temp = data.frame(svytotal(dat[[i]]$elpd_1 - dat[[i]]$elpd_4, rake[[i]]))
colnames(temp) = c('elpd_diff_wtd_14', 'se_diff_wtd_14')
diff14[[i]] = temp
}
wtd_diff14 = do.call(rbind,diff14)
diff23 = lapply(1:length(dat), function(x)vector(length = 2))
for(i in 1:length(dat)){
temp = data.frame(svytotal(dat[[i]]$elpd_2 - dat[[i]]$elpd_3, rake[[i]]))
colnames(temp) = c('elpd_diff_wtd_23', 'se_diff_wtd_23')
diff23[[i]] = temp
}
wtd_diff23 = do.call(rbind,diff23)
diff24 = lapply(1:length(dat), function(x)vector(length = 2))
for(i in 1:length(dat)){
temp = data.frame(svytotal(dat[[i]]$elpd_2 - dat[[i]]$elpd_4, rake[[i]]))
colnames(temp) = c('elpd_diff_wtd_24', 'se_diff_wtd_24')
diff24[[i]] = temp
}
wtd_diff24 = do.call(rbind,diff24)
diff34 = lapply(1:length(dat), function(x)vector(length = 2))
for(i in 1:length(dat)){
temp = data.frame(svytotal(dat[[i]]$elpd_3 - dat[[i]]$elpd_4, rake[[i]]))
colnames(temp) = c('elpd_diff_wtd_34', 'se_diff_wtd_34')
diff34[[i]] = temp
}
wtd_diff34 = do.call(rbind,diff34)
wtd_diff34
dat = samp_data_list[1:60]
rake = lapply(dat, function(x)svydesign(ids=~1,weights=~wts,data=x))
diff12 = lapply(1:length(dat), function(x)vector(length = 2))
for(i in 1:length(dat)){
temp = data.frame(svytotal(dat[[i]]$elpd_1 - dat[[i]]$elpd_2, rake[[i]]))
colnames(temp) = c('elpd_diff_wtd_12', 'se_diff_wtd_12')
diff12[[i]] = temp
}
wtd_diff12 = do.call(rbind,diff12)
diff13 = lapply(1:length(dat), function(x)vector(length = 2))
for(i in 1:length(dat)){
temp = data.frame(svytotal(dat[[i]]$elpd_1 - dat[[i]]$elpd_3, rake[[i]]))
colnames(temp) = c('elpd_diff_wtd_13', 'se_diff_wtd_13')
diff13[[i]] = temp
}
wtd_diff13 = do.call(rbind,diff13)
diff14 = lapply(1:length(dat), function(x)vector(length = 2))
for(i in 1:length(dat)){
temp = data.frame(svytotal(dat[[i]]$elpd_1 - dat[[i]]$elpd_4, rake[[i]]))
colnames(temp) = c('elpd_diff_wtd_14', 'se_diff_wtd_14')
diff14[[i]] = temp
}
wtd_diff14 = do.call(rbind,diff14)
diff23 = lapply(1:length(dat), function(x)vector(length = 2))
for(i in 1:length(dat)){
temp = data.frame(svytotal(dat[[i]]$elpd_2 - dat[[i]]$elpd_3, rake[[i]]))
colnames(temp) = c('elpd_diff_wtd_23', 'se_diff_wtd_23')
diff23[[i]] = temp
}
wtd_diff23 = do.call(rbind,diff23)
diff24 = lapply(1:length(dat), function(x)vector(length = 2))
for(i in 1:length(dat)){
temp = data.frame(svytotal(dat[[i]]$elpd_2 - dat[[i]]$elpd_4, rake[[i]]))
colnames(temp) = c('elpd_diff_wtd_24', 'se_diff_wtd_24')
diff24[[i]] = temp
}
wtd_diff24 = do.call(rbind,diff24)
diff34 = lapply(1:length(dat), function(x)vector(length = 2))
for(i in 1:length(dat)){
temp = data.frame(svytotal(dat[[i]]$elpd_3 - dat[[i]]$elpd_4, rake[[i]]))
colnames(temp) = c('elpd_diff_wtd_34', 'se_diff_wtd_34')
diff34[[i]] = temp
}
wtd_diff34 = do.call(rbind,diff34)
## combining and plotting
wtd_diff_all = (cbind(wtd_diff12, wtd_diff13, wtd_diff14, wtd_diff23, wtd_diff24, wtd_diff34))
wtd_diff_elpd_melt = wtd_diff_all[,grep('^elpd', colnames(wtd_diff_all))] %>%
as.data.frame(.) %>%
melt(.)
wtd_diff_elpd_melt
wtd_diff_se_melt = wtd_diff_all[,grep('^se', colnames(wtd_diff_all))] %>%
as.data.frame(.) %>%
melt(.)
gg1 = ggplot(wtd_diff_elpd_melt, aes(x=variable, y=value, fill=variable)) +
geom_violin() + labs(title="Pairwise elpd_wtd_diff") +
theme(legend.position = "none") +
scale_fill_brewer(palette = "Dark2") +
labs(x="", y="elpd wtd_diff")
gg1 = ggplot(wtd_diff_elpd_melt, aes(x=variable, y=value, fill=variable)) +
geom_violin() + labs(title="Pairwise elpd_wtd_diff") +
theme(legend.position = "none") +
scale_fill_brewer(palette = "RdYlGn") +
labs(x="", y="elpd wtd_diff")
gg2 = ggplot(wtd_diff_se_melt, aes(x=variable, y=value, fill=variable)) +
geom_violin() + labs(title="Pairwise se_wtd_diff") +
theme(legend.position = "none") +
scale_fill_brewer(palette = "RdYlGn") +
labs(x="", y="std. error wtd_diff")
gg1
gridExtra::grid.arrange(gg1,gg2)
png(file="loo_elpd_se_wtd_diff_popn1.png", width=700, height=790)
gridExtra::grid.arrange(gg1,gg2)
dev.off()
